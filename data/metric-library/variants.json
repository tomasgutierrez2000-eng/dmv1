[
  {
    "variant_id": "PD",
    "variant_name": "Probability of Default",
    "parent_metric_id": "PD",
    "variant_type": "SOURCED",
    "status": "ACTIVE",
    "formula_display": "PD model output per obligor",
    "rollup_logic": {
      "facility": "Raw sourced value",
      "counterparty": "SUM(pd * facility_ead) / SUM(facility_ead)",
      "desk": "SUM(pd * cpty_ead) / SUM(cpty_ead)",
      "portfolio": "SUM(pd * desk_ead) / SUM(desk_ead)",
      "lob": "SUM(pd * portfolio_ead) / SUM(portfolio_ead)"
    },
    "weighting_basis": "BY_EAD",
    "source_table": "counterparty",
    "source_field": "pd_annual"
  },
  {
    "variant_id": "LGD",
    "variant_name": "Loss Given Default",
    "parent_metric_id": "LGD",
    "variant_type": "SOURCED",
    "status": "ACTIVE",
    "formula_display": "1 - Recovery Rate",
    "rollup_logic": {
      "facility": "Raw sourced value",
      "counterparty": "SUM(lgd * facility_ead) / SUM(facility_ead)",
      "desk": "SUM(lgd * cpty_ead) / SUM(cpty_ead)",
      "portfolio": "SUM(lgd * desk_ead) / SUM(desk_ead)",
      "lob": "SUM(lgd * portfolio_ead) / SUM(portfolio_ead)"
    },
    "weighting_basis": "BY_EAD",
    "source_table": "position",
    "source_field": "lgd_estimate"
  },
  {
    "variant_id": "EAD",
    "variant_name": "Exposure at Default",
    "parent_metric_id": "EAD",
    "variant_type": "HYBRID",
    "status": "ACTIVE",
    "formula_display": "Outstanding + CCF * Undrawn",
    "rollup_logic": {
      "facility": "Raw sourced value",
      "counterparty": "SUM across facilities",
      "desk": "SUM across counterparties",
      "portfolio": "SUM across desks",
      "lob": "SUM across portfolios"
    },
    "source_table": "position",
    "source_field": "ead_amt"
  },
  {
    "variant_id": "EL",
    "variant_name": "Expected Loss",
    "parent_metric_id": "EL",
    "variant_type": "CALCULATED",
    "status": "ACTIVE",
    "formula_display": "PD * LGD * EAD",
    "rollup_logic": {
      "facility": "Raw sourced value",
      "counterparty": "SUM across facilities",
      "desk": "SUM across counterparties",
      "portfolio": "SUM across desks",
      "lob": "SUM across portfolios"
    }
  },
  {
    "variant_id": "EL_RATE",
    "variant_name": "Expected Loss Rate",
    "parent_metric_id": "EL_RATE",
    "variant_type": "CALCULATED",
    "status": "ACTIVE",
    "formula_display": "Expected Loss / Exposure * 100",
    "rollup_logic": {
      "facility": "Raw sourced or calculated value",
      "counterparty": "SUM(expected_loss) / SUM(exposure)",
      "desk": "SUM(expected_loss) / SUM(exposure)",
      "portfolio": "SUM(expected_loss) / SUM(exposure)",
      "lob": "SUM(expected_loss) / SUM(exposure)"
    }
  },
  {
    "variant_id": "IRR",
    "variant_name": "Internal Risk Rating",
    "parent_metric_id": "IRR",
    "variant_type": "SOURCED",
    "status": "ACTIVE",
    "formula_display": "Rating model output (numeric mapping)",
    "rollup_logic": {
      "facility": "Raw sourced value",
      "counterparty": "SUM(rating_numeric * facility_ead) / SUM(facility_ead)",
      "desk": "SUM(rating_numeric * cpty_ead) / SUM(cpty_ead)",
      "portfolio": "SUM(rating_numeric * desk_ead) / SUM(desk_ead)",
      "lob": "SUM(rating_numeric * portfolio_ead) / SUM(portfolio_ead)"
    },
    "weighting_basis": "BY_EAD",
    "source_table": "counterparty",
    "source_field": "internal_risk_rating"
  },
  {
    "variant_id": "EXT_RATING",
    "variant_name": "External Rating",
    "parent_metric_id": "EXT_RATING",
    "variant_type": "SOURCED",
    "status": "ACTIVE",
    "formula_display": "Agency rating (Moody's/S&P/Fitch)",
    "rollup_logic": {
      "facility": "Raw rating_bucket value",
      "counterparty": "Raw rating_bucket value",
      "desk": "Distribution of rating_bucket by exposure",
      "portfolio": "Distribution of rating_bucket by exposure",
      "lob": "Distribution of rating_bucket by exposure"
    },
    "source_table": "counterparty",
    "source_field": "external_rating_fitch"
  },
  {
    "variant_id": "DELINQ_RATE",
    "variant_name": "Delinquency Rate",
    "parent_metric_id": "DELINQ_RATE",
    "variant_type": "CALCULATED",
    "status": "ACTIVE",
    "formula_display": "Count(Delinquent) / Total Count * 100",
    "rollup_logic": {
      "facility": "Raw sourced or calculated value",
      "counterparty": "SUM(delinquent_count) / SUM(total_count)",
      "desk": "SUM(delinquent_count) / SUM(total_count)",
      "portfolio": "SUM(delinquent_count) / SUM(total_count)",
      "lob": "SUM(delinquent_count) / SUM(total_count)"
    }
  },
  {
    "variant_id": "CRITICIZED",
    "variant_name": "Criticized Indicator",
    "parent_metric_id": "CRITICIZED",
    "variant_type": "SOURCED",
    "status": "ACTIVE",
    "formula_display": "Criticized flag per OCC guidelines",
    "rollup_logic": {
      "facility": "Sourced flag (0/1)",
      "counterparty": "Raw flag value",
      "desk": "COUNT(criticized_flag) and COUNT(criticized_flag) / COUNT(*) * 100",
      "portfolio": "COUNT(criticized_flag) and COUNT(criticized_flag) / COUNT(*) * 100",
      "lob": "COUNT(criticized_flag) and COUNT(criticized_flag) / COUNT(*) * 100"
    },
    "source_table": "counterparty",
    "source_field": "criticized_flag"
  },
  {
    "variant_id": "DETERIORATED",
    "variant_name": "Deteriorated Indicator",
    "parent_metric_id": "DETERIORATED",
    "variant_type": "CALCULATED",
    "status": "ACTIVE",
    "formula_display": "CASE WHEN Current_Rating > Prior_Rating THEN 1 ELSE 0",
    "rollup_logic": {
      "facility": "Sourced flag (0/1)",
      "counterparty": "Raw flag value",
      "desk": "COUNT(deteriorated_flag) and COUNT(deteriorated_flag) / COUNT(*) * 100",
      "portfolio": "COUNT(deteriorated_flag) and COUNT(deteriorated_flag) / COUNT(*) * 100",
      "lob": "COUNT(deteriorated_flag) and COUNT(deteriorated_flag) / COUNT(*) * 100"
    }
  },
  {
    "variant_id": "DAYS_OVERDUE",
    "variant_name": "Days Overdue",
    "parent_metric_id": "DAYS_OVERDUE",
    "variant_type": "SOURCED",
    "status": "ACTIVE",
    "formula_display": "Current Date - Payment Due Date",
    "rollup_logic": {
      "facility": "Raw sourced value",
      "counterparty": "MAX(days_overdue) across facilities",
      "desk": "MAX(days_overdue) for worst-case; EAD-weighted avg for portfolio view",
      "portfolio": "MAX(days_overdue) for worst-case; EAD-weighted avg for portfolio view",
      "lob": "MAX(days_overdue) for worst-case; EAD-weighted avg for portfolio view"
    },
    "source_table": "loan_position",
    "source_field": "days_past_due"
  },
  {
    "variant_id": "EXPOSURE",
    "variant_name": "Exposure Outstanding",
    "parent_metric_id": "EXPOSURE",
    "variant_type": "SOURCED",
    "status": "ACTIVE",
    "formula_display": "Sum of outstanding balances",
    "rollup_logic": {
      "facility": "Raw sourced value",
      "counterparty": "SUM across facilities",
      "desk": "SUM across counterparties",
      "portfolio": "SUM across desks",
      "lob": "SUM across portfolios"
    },
    "source_table": "facility_exposure_snapshot",
    "source_field": "exposure_amount"
  },
  {
    "variant_id": "COMMITTED",
    "variant_name": "Committed Amount",
    "parent_metric_id": "COMMITTED",
    "variant_type": "SOURCED",
    "status": "ACTIVE",
    "formula_display": "Sum of committed facility amounts",
    "rollup_logic": {
      "facility": "Raw sourced value",
      "counterparty": "SUM across facilities",
      "desk": "SUM across counterparties",
      "portfolio": "SUM across desks",
      "lob": "SUM across portfolios"
    },
    "source_table": "facility_master",
    "source_field": "committed_facility_amt"
  },
  {
    "variant_id": "UNDRAWN",
    "variant_name": "Undrawn Exposure",
    "parent_metric_id": "UNDRAWN",
    "variant_type": "CALCULATED",
    "status": "ACTIVE",
    "formula_display": "Committed Amount - Utilized Amount",
    "rollup_logic": {
      "facility": "Raw sourced value",
      "counterparty": "SUM across facilities",
      "desk": "SUM across counterparties",
      "portfolio": "SUM across desks",
      "lob": "SUM across portfolios"
    }
  },
  {
    "variant_id": "UTILIZED",
    "variant_name": "Utilized Exposure",
    "parent_metric_id": "UTILIZED",
    "variant_type": "SOURCED",
    "status": "ACTIVE",
    "formula_display": "Sum of drawn amounts",
    "rollup_logic": {
      "facility": "Raw sourced value",
      "counterparty": "SUM across facilities",
      "desk": "SUM across counterparties",
      "portfolio": "SUM across desks",
      "lob": "SUM across portfolios"
    },
    "source_table": "limit_attribution_summary",
    "source_field": "contribution_amt"
  },
  {
    "variant_id": "UTIL_PCT",
    "variant_name": "Utilization Rate",
    "parent_metric_id": "UTIL_PCT",
    "variant_type": "CALCULATED",
    "status": "ACTIVE",
    "formula_display": "Exposure / Committed Amount * 100",
    "rollup_logic": {
      "facility": "Raw sourced or calculated value",
      "counterparty": "SUM(exposure) / SUM(committed_amount)",
      "desk": "SUM(exposure) / SUM(committed_amount)",
      "portfolio": "SUM(exposure) / SUM(committed_amount)",
      "lob": "SUM(exposure) / SUM(committed_amount)"
    }
  },
  {
    "variant_id": "LIMIT",
    "variant_name": "Exposure Limit",
    "parent_metric_id": "LIMIT",
    "variant_type": "SOURCED",
    "status": "ACTIVE",
    "formula_display": "Approved limit per counterparty",
    "rollup_logic": {
      "facility": "Raw sourced value",
      "counterparty": "SUM across facilities",
      "desk": "SUM across counterparties",
      "portfolio": "SUM across desks",
      "lob": "SUM across portfolios"
    },
    "source_table": "limit_definition",
    "source_field": "limit_value"
  },
  {
    "variant_id": "CROSS_ENTITY_EXP",
    "variant_name": "Cross-Entity Exposure",
    "parent_metric_id": "CROSS_ENTITY_EXP",
    "variant_type": "CALCULATED",
    "status": "ACTIVE",
    "formula_display": "SUM(exposure) WHERE cross_entity_flag = 1",
    "rollup_logic": {
      "facility": "Raw sourced value",
      "counterparty": "SUM across facilities",
      "desk": "SUM across counterparties",
      "portfolio": "SUM across desks",
      "lob": "SUM across portfolios"
    }
  },
  {
    "variant_id": "GROSS_EXP",
    "variant_name": "Gross Exposure",
    "parent_metric_id": "GROSS_EXP",
    "variant_type": "SOURCED",
    "status": "ACTIVE",
    "formula_display": "Sum of pre-CRM exposure",
    "rollup_logic": {
      "facility": "Raw sourced value",
      "counterparty": "SUM across facilities",
      "desk": "SUM across counterparties",
      "portfolio": "SUM across desks",
      "lob": "SUM across portfolios"
    },
    "source_table": "position_exposure_snapshot",
    "source_field": "gross_exposure_usd"
  },
  {
    "variant_id": "NET_EXP",
    "variant_name": "Net Exposure",
    "parent_metric_id": "NET_EXP",
    "variant_type": "CALCULATED",
    "status": "ACTIVE",
    "formula_display": "Gross Exposure - CRM Amount",
    "rollup_logic": {
      "facility": "Raw sourced value",
      "counterparty": "SUM across facilities",
      "desk": "SUM across counterparties",
      "portfolio": "SUM across desks",
      "lob": "SUM across portfolios"
    }
  },
  {
    "variant_id": "DSCR",
    "variant_name": "Debt Service Coverage Ratio",
    "parent_metric_id": "DSCR",
    "variant_type": "CALCULATED",
    "status": "ACTIVE",
    "formula_display": "Cashflow / Total Debt Service",
    "rollup_logic": {
      "facility": "Raw sourced value",
      "counterparty": "SUM(dscr * facility_exposure) / SUM(facility_exposure)",
      "desk": "SUM(dscr * cpty_exposure) / SUM(cpty_exposure)",
      "portfolio": "SUM(dscr * desk_exposure) / SUM(desk_exposure)",
      "lob": "SUM(dscr * portfolio_exposure) / SUM(portfolio_exposure)"
    },
    "weighting_basis": "BY_EAD"
  },
  {
    "variant_id": "LTV",
    "variant_name": "Loan-to-Value Ratio",
    "parent_metric_id": "LTV",
    "variant_type": "CALCULATED",
    "status": "ACTIVE",
    "formula_display": "Exposure / Collateral Value * 100",
    "rollup_logic": {
      "facility": "Raw sourced value",
      "counterparty": "SUM(ltv * facility_exposure) / SUM(facility_exposure)",
      "desk": "SUM(ltv * cpty_exposure) / SUM(cpty_exposure)",
      "portfolio": "SUM(ltv * desk_exposure) / SUM(desk_exposure)",
      "lob": "SUM(ltv * portfolio_exposure) / SUM(portfolio_exposure)"
    },
    "weighting_basis": "BY_EAD"
  },
  {
    "variant_id": "ROE",
    "variant_name": "Return on Equity",
    "parent_metric_id": "ROE",
    "variant_type": "CALCULATED",
    "status": "ACTIVE",
    "formula_display": "Net Income / Equity * 100",
    "rollup_logic": {
      "facility": "Raw sourced value",
      "counterparty": "SUM(roe * facility_capital_allocated) / SUM(facility_capital_allocated)",
      "desk": "SUM(roe * cpty_capital_allocated) / SUM(cpty_capital_allocated)",
      "portfolio": "SUM(roe * desk_capital_allocated) / SUM(desk_capital_allocated)",
      "lob": "SUM(roe * portfolio_capital_allocated) / SUM(portfolio_capital_allocated)"
    },
    "weighting_basis": "BY_EAD"
  },
  {
    "variant_id": "ROA",
    "variant_name": "Return on Assets",
    "parent_metric_id": "ROA",
    "variant_type": "CALCULATED",
    "status": "ACTIVE",
    "formula_display": "Net Income / Total Assets * 100",
    "rollup_logic": {
      "facility": "Raw sourced value",
      "counterparty": "SUM(roa * facility_exposure) / SUM(facility_exposure)",
      "desk": "SUM(roa * cpty_exposure) / SUM(cpty_exposure)",
      "portfolio": "SUM(roa * desk_exposure) / SUM(desk_exposure)",
      "lob": "SUM(roa * portfolio_exposure) / SUM(portfolio_exposure)"
    },
    "weighting_basis": "BY_EAD"
  },
  {
    "variant_id": "NIM",
    "variant_name": "Net Interest Margin",
    "parent_metric_id": "NIM",
    "variant_type": "CALCULATED",
    "status": "ACTIVE",
    "formula_display": "Net Interest Income / Earning Assets * 100",
    "rollup_logic": {
      "facility": "Raw sourced value",
      "counterparty": "SUM(nim * facility_exposure) / SUM(facility_exposure)",
      "desk": "SUM(nim * cpty_exposure) / SUM(cpty_exposure)",
      "portfolio": "SUM(nim * desk_exposure) / SUM(desk_exposure)",
      "lob": "SUM(nim * portfolio_exposure) / SUM(portfolio_exposure)"
    },
    "weighting_basis": "BY_EAD"
  },
  {
    "variant_id": "ALL_IN_RATE",
    "variant_name": "All-in Rate",
    "parent_metric_id": "ALL_IN_RATE",
    "variant_type": "CALCULATED",
    "status": "ACTIVE",
    "formula_display": "Base Rate + Spread",
    "rollup_logic": {
      "facility": "Raw sourced value",
      "counterparty": "SUM(all_in_rate * facility_exposure) / SUM(facility_exposure)",
      "desk": "SUM(all_in_rate * cpty_exposure) / SUM(cpty_exposure)",
      "portfolio": "SUM(all_in_rate * desk_exposure) / SUM(desk_exposure)",
      "lob": "SUM(all_in_rate * portfolio_exposure) / SUM(portfolio_exposure)"
    },
    "weighting_basis": "BY_EAD"
  },
  {
    "variant_id": "SPREAD",
    "variant_name": "Credit Spread",
    "parent_metric_id": "SPREAD",
    "variant_type": "SOURCED",
    "status": "ACTIVE",
    "formula_display": "Contractual spread",
    "rollup_logic": {
      "facility": "Raw sourced value",
      "counterparty": "SUM(spread * facility_exposure) / SUM(facility_exposure)",
      "desk": "SUM(spread * cpty_exposure) / SUM(cpty_exposure)",
      "portfolio": "SUM(spread * desk_exposure) / SUM(desk_exposure)",
      "lob": "SUM(spread * portfolio_exposure) / SUM(portfolio_exposure)"
    },
    "weighting_basis": "BY_EAD",
    "source_table": "loan_position",
    "source_field": "spread_bps"
  },
  {
    "variant_id": "BASE_RATE",
    "variant_name": "Base Rate",
    "parent_metric_id": "BASE_RATE",
    "variant_type": "SOURCED",
    "status": "ACTIVE",
    "formula_display": "SOFR / Prime / fixed rate",
    "rollup_logic": {
      "facility": "Raw sourced value",
      "counterparty": "SUM(base_rate * facility_exposure) / SUM(facility_exposure)",
      "desk": "SUM(base_rate * cpty_exposure) / SUM(cpty_exposure)",
      "portfolio": "SUM(base_rate * desk_exposure) / SUM(desk_exposure)",
      "lob": "SUM(base_rate * portfolio_exposure) / SUM(portfolio_exposure)"
    },
    "weighting_basis": "BY_EAD",
    "source_table": "facility_master",
    "source_field": "interest_rate_reference"
  },
  {
    "variant_id": "REVENUE",
    "variant_name": "Revenue",
    "parent_metric_id": "REVENUE",
    "variant_type": "SOURCED",
    "status": "ACTIVE",
    "formula_display": "Gross revenue",
    "rollup_logic": {
      "facility": "Raw sourced value",
      "counterparty": "SUM across facilities",
      "desk": "SUM across counterparties",
      "portfolio": "SUM across desks",
      "lob": "SUM across portfolios"
    },
    "source_table": "facility_profitability",
    "source_field": "revenue_amt"
  },
  {
    "variant_id": "NET_INCOME",
    "variant_name": "Net Income",
    "parent_metric_id": "NET_INCOME",
    "variant_type": "SOURCED",
    "status": "ACTIVE",
    "formula_display": "Revenue - Expenses - Taxes",
    "rollup_logic": {
      "facility": "Raw sourced value",
      "counterparty": "SUM across facilities",
      "desk": "SUM across counterparties",
      "portfolio": "SUM across desks",
      "lob": "SUM across portfolios"
    },
    "source_table": "facility_profitability",
    "source_field": "net_income_amt"
  },
  {
    "variant_id": "CASHFLOW",
    "variant_name": "Operating Cashflow",
    "parent_metric_id": "CASHFLOW",
    "variant_type": "SOURCED",
    "status": "ACTIVE",
    "formula_display": "Cash from operations",
    "rollup_logic": {
      "facility": "Raw sourced value",
      "counterparty": "SUM across facilities",
      "desk": "SUM across counterparties",
      "portfolio": "SUM across desks",
      "lob": "SUM across portfolios"
    },
    "source_table": "cash_flow",
    "source_field": "cash_flow"
  },
  {
    "variant_id": "TDS",
    "variant_name": "Total Debt Service",
    "parent_metric_id": "TDS",
    "variant_type": "SOURCED",
    "status": "ACTIVE",
    "formula_display": "Principal + Interest payments",
    "rollup_logic": {
      "facility": "Raw sourced value",
      "counterparty": "SUM across facilities",
      "desk": "SUM across counterparties",
      "portfolio": "SUM across desks",
      "lob": "SUM across portfolios"
    },
    "source_table": "facility_profitability",
    "source_field": "total_debt_service_amt"
  },
  {
    "variant_id": "FEE_RATE",
    "variant_name": "Fee Rate",
    "parent_metric_id": "FEE_RATE",
    "variant_type": "SOURCED",
    "status": "ACTIVE",
    "formula_display": "Annual fee / Committed Amount",
    "rollup_logic": {
      "facility": "Raw sourced value",
      "counterparty": "SUM(fee_rate * facility_committed) / SUM(facility_committed)",
      "desk": "SUM(fee_rate * cpty_committed) / SUM(cpty_committed)",
      "portfolio": "SUM(fee_rate * desk_committed) / SUM(desk_committed)",
      "lob": "SUM(fee_rate * portfolio_committed) / SUM(portfolio_committed)"
    },
    "weighting_basis": "BY_COMMITTED",
    "source_table": "facility_master",
    "source_field": "fee_rate_pct"
  },
  {
    "variant_id": "COST_OF_FUNDS",
    "variant_name": "Cost of Funds",
    "parent_metric_id": "COST_OF_FUNDS",
    "variant_type": "SOURCED",
    "status": "ACTIVE",
    "formula_display": "Transfer pricing allocation",
    "rollup_logic": {
      "facility": "Raw sourced value",
      "counterparty": "SUM across facilities",
      "desk": "SUM across counterparties",
      "portfolio": "SUM across desks",
      "lob": "SUM across portfolios"
    },
    "source_table": "facility_profitability",
    "source_field": "cost_of_funds_amt"
  },
  {
    "variant_id": "CAP_ALLOC",
    "variant_name": "Capital Allocated",
    "parent_metric_id": "CAP_ALLOC",
    "variant_type": "CALCULATED",
    "status": "ACTIVE",
    "formula_display": "RWA * Capital Ratio",
    "rollup_logic": {
      "facility": "Raw sourced value",
      "counterparty": "SUM across facilities",
      "desk": "SUM across counterparties",
      "portfolio": "SUM across desks",
      "lob": "SUM across portfolios"
    }
  },
  {
    "variant_id": "OP_COST",
    "variant_name": "Operating Cost",
    "parent_metric_id": "OP_COST",
    "variant_type": "SOURCED",
    "status": "ACTIVE",
    "formula_display": "Allocated operating expense",
    "rollup_logic": {
      "facility": "Raw sourced value",
      "counterparty": "SUM across facilities",
      "desk": "SUM across counterparties",
      "portfolio": "SUM across desks",
      "lob": "SUM across portfolios"
    },
    "source_table": "facility_profitability",
    "source_field": "operating_cost_amt"
  },
  {
    "variant_id": "COLLATERAL",
    "variant_name": "Collateral Value",
    "parent_metric_id": "COLLATERAL",
    "variant_type": "SOURCED",
    "status": "ACTIVE",
    "formula_display": "Appraised or mark-to-market value",
    "rollup_logic": {
      "facility": "Raw sourced value",
      "counterparty": "SUM across facilities",
      "desk": "SUM across counterparties",
      "portfolio": "SUM across desks",
      "lob": "SUM across portfolios"
    },
    "source_table": "collateral_snapshot",
    "source_field": "collateral_value_amt"
  },
  {
    "variant_id": "CRM_AMOUNT",
    "variant_name": "Risk Mitigant Amount",
    "parent_metric_id": "CRM_AMOUNT",
    "variant_type": "CALCULATED",
    "status": "ACTIVE",
    "formula_display": "SUM(eligible_mitigant_value)",
    "rollup_logic": {
      "facility": "Raw sourced value",
      "counterparty": "SUM across facilities",
      "desk": "SUM across counterparties",
      "portfolio": "SUM across desks",
      "lob": "SUM across portfolios"
    }
  },
  {
    "variant_id": "CRM_TYPE",
    "variant_name": "Risk Mitigant Type",
    "parent_metric_id": "CRM_TYPE",
    "variant_type": "SOURCED",
    "status": "ACTIVE",
    "formula_display": "ARGMAX(mitigant_type, SUM(mitigant_value))",
    "rollup_logic": {
      "facility": "Raw mitigant_type value",
      "counterparty": "Raw mitigant_type value",
      "desk": "Distribution of mitigant_type by exposure",
      "portfolio": "Distribution of mitigant_type by exposure",
      "lob": "Distribution of mitigant_type by exposure"
    },
    "source_table": "collateral_asset_master",
    "source_field": "collateral_asset_type"
  },
  {
    "variant_id": "COLLATERAL_COV",
    "variant_name": "Collateral Coverage Ratio",
    "parent_metric_id": "COLLATERAL_COV",
    "variant_type": "CALCULATED",
    "status": "ACTIVE",
    "formula_display": "Collateral Value / Exposure * 100",
    "rollup_logic": {
      "facility": "Raw sourced or calculated value",
      "counterparty": "SUM(collateral_value) / SUM(exposure)",
      "desk": "SUM(collateral_value) / SUM(exposure)",
      "portfolio": "SUM(collateral_value) / SUM(exposure)",
      "lob": "SUM(collateral_value) / SUM(exposure)"
    }
  },
  {
    "variant_id": "AVG_SPREAD",
    "variant_name": "Weighted Average Spread",
    "parent_metric_id": "AVG_SPREAD",
    "variant_type": "CALCULATED",
    "status": "ACTIVE",
    "formula_display": "SUM(Spread * Exposure) / Total Exposure",
    "rollup_logic": {
      "facility": "Raw sourced value",
      "counterparty": "SUM(spread * facility_exposure) / SUM(facility_exposure)",
      "desk": "SUM(spread * cpty_exposure) / SUM(cpty_exposure)",
      "portfolio": "SUM(spread * desk_exposure) / SUM(desk_exposure)",
      "lob": "SUM(spread * portfolio_exposure) / SUM(portfolio_exposure)"
    },
    "weighting_basis": "BY_EAD"
  },
  {
    "variant_id": "AVG_TENOR",
    "variant_name": "Weighted Average Tenor",
    "parent_metric_id": "AVG_TENOR",
    "variant_type": "CALCULATED",
    "status": "ACTIVE",
    "formula_display": "SUM(Tenor * Exposure) / Total Exposure",
    "rollup_logic": {
      "facility": "Raw sourced value",
      "counterparty": "SUM(tenor * facility_exposure) / SUM(facility_exposure)",
      "desk": "SUM(tenor * cpty_exposure) / SUM(cpty_exposure)",
      "portfolio": "SUM(tenor * desk_exposure) / SUM(desk_exposure)",
      "lob": "SUM(tenor * portfolio_exposure) / SUM(portfolio_exposure)"
    },
    "weighting_basis": "BY_EAD"
  },
  {
    "variant_id": "DAYS_DELINQ",
    "variant_name": "Days Delinquent",
    "parent_metric_id": "DAYS_DELINQ",
    "variant_type": "SOURCED",
    "status": "ACTIVE",
    "formula_display": "Days since payment due date",
    "rollup_logic": {
      "facility": "Raw sourced value",
      "counterparty": "MAX(days_delinquent) across facilities",
      "desk": "MAX(days_delinquent) for worst-case; EAD-weighted avg for portfolio view",
      "portfolio": "MAX(days_delinquent) for worst-case; EAD-weighted avg for portfolio view",
      "lob": "MAX(days_delinquent) for worst-case; EAD-weighted avg for portfolio view"
    },
    "source_table": "loan_position",
    "source_field": "days_past_due"
  },
  {
    "variant_id": "DELINQ_AMT",
    "variant_name": "Delinquent Amount",
    "parent_metric_id": "DELINQ_AMT",
    "variant_type": "SOURCED",
    "status": "ACTIVE",
    "formula_display": "Sum of past-due amounts",
    "rollup_logic": {
      "facility": "Raw sourced value",
      "counterparty": "SUM across facilities",
      "desk": "SUM across counterparties",
      "portfolio": "SUM across desks",
      "lob": "SUM across portfolios"
    },
    "source_table": "loan_position",
    "source_field": "delinquent_amount"
  },
  {
    "variant_id": "DAYS_TO_MAT",
    "variant_name": "Days Until Maturity",
    "parent_metric_id": "DAYS_TO_MAT",
    "variant_type": "CALCULATED",
    "status": "ACTIVE",
    "formula_display": "Maturity Date - Reporting Date",
    "rollup_logic": {
      "facility": "Raw sourced value",
      "counterparty": "SUM(days_to_mat * facility_exposure) / SUM(facility_exposure)",
      "desk": "SUM(days_to_mat * cpty_exposure) / SUM(cpty_exposure)",
      "portfolio": "SUM(days_to_mat * desk_exposure) / SUM(desk_exposure)",
      "lob": "SUM(days_to_mat * portfolio_exposure) / SUM(portfolio_exposure)"
    },
    "weighting_basis": "BY_EAD"
  },
  {
    "variant_id": "CPTY_ALLOC",
    "variant_name": "Counterparty Concentration",
    "parent_metric_id": "CPTY_ALLOC",
    "variant_type": "CALCULATED",
    "status": "ACTIVE",
    "formula_display": "(Counterparty Exposure / Total Exposure) * 100",
    "rollup_logic": {
      "facility": "N/A",
      "counterparty": "Counterparty Exposure / Total Portfolio Exposure * 100",
      "desk": "Counterparty Exposure / Desk Total Exposure * 100",
      "portfolio": "Counterparty Exposure / Portfolio Total Exposure * 100",
      "lob": "Counterparty Exposure / LoB Total Exposure * 100"
    }
  },
  {
    "variant_id": "RATING_MIG_INT",
    "variant_name": "Internal Rating Migration",
    "parent_metric_id": "RATING_MIG_INT",
    "variant_type": "CALCULATED",
    "status": "ACTIVE",
    "formula_display": "Compare Current vs Prior Period Internal Rating",
    "rollup_logic": {
      "facility": "Raw migration_direction value",
      "counterparty": "Raw migration_direction value",
      "desk": "Distribution of migration_direction by exposure",
      "portfolio": "Distribution of migration_direction by exposure",
      "lob": "Distribution of migration_direction by exposure"
    }
  },
  {
    "variant_id": "RATING_MIG_EXT",
    "variant_name": "External Rating Migration",
    "parent_metric_id": "RATING_MIG_EXT",
    "variant_type": "CALCULATED",
    "status": "ACTIVE",
    "formula_display": "Compare Current vs Prior Period External Rating",
    "rollup_logic": {
      "facility": "Raw migration_direction value",
      "counterparty": "Raw migration_direction value",
      "desk": "Distribution of migration_direction by exposure",
      "portfolio": "Distribution of migration_direction by exposure",
      "lob": "Distribution of migration_direction by exposure"
    }
  },
  {
    "variant_id": "EXT_RATING_CHG_STEPS",
    "variant_name": "External Rating Change Steps",
    "parent_metric_id": "EXT_RATING_CHG_STEPS",
    "variant_type": "CALCULATED",
    "status": "ACTIVE",
    "formula_display": "Current Notch - Prior Notch",
    "rollup_logic": {
      "facility": "Raw sourced value",
      "counterparty": "SUM(notch_change * facility_exposure) / SUM(facility_exposure)",
      "desk": "SUM(notch_change * cpty_exposure) / SUM(cpty_exposure)",
      "portfolio": "SUM(notch_change * desk_exposure) / SUM(desk_exposure)",
      "lob": "SUM(notch_change * portfolio_exposure) / SUM(portfolio_exposure)"
    },
    "weighting_basis": "BY_EAD"
  },
  {
    "variant_id": "LOAN_COUNT",
    "variant_name": "Loan Count",
    "parent_metric_id": "LOAN_COUNT",
    "variant_type": "CALCULATED",
    "status": "ACTIVE",
    "formula_display": "COUNT(DISTINCT facility_id)",
    "rollup_logic": {
      "facility": "Raw sourced value",
      "counterparty": "SUM across facilities",
      "desk": "SUM across counterparties",
      "portfolio": "SUM across desks",
      "lob": "SUM across portfolios"
    }
  },
  {
    "variant_id": "INT_RATING_CHG",
    "variant_name": "Internal Rating Change (Notches)",
    "parent_metric_id": "INT_RATING_CHG",
    "variant_type": "CALCULATED",
    "status": "ACTIVE",
    "formula_display": "Current Numeric Rating - Prior Numeric Rating",
    "rollup_logic": {
      "facility": "Raw sourced value",
      "counterparty": "SUM(notch_change * facility_exposure) / SUM(facility_exposure)",
      "desk": "SUM(notch_change * cpty_exposure) / SUM(cpty_exposure)",
      "portfolio": "SUM(notch_change * desk_exposure) / SUM(desk_exposure)",
      "lob": "SUM(notch_change * portfolio_exposure) / SUM(portfolio_exposure)"
    },
    "weighting_basis": "BY_EAD"
  },
  {
    "variant_id": "PRICING_EXCEPTION",
    "variant_name": "Pricing Exception Status",
    "parent_metric_id": "PRICING_EXCEPTION",
    "variant_type": "SOURCED",
    "status": "ACTIVE",
    "formula_display": "Policy exception flag",
    "rollup_logic": {
      "facility": "Sourced flag (0/1)",
      "counterparty": "Raw flag value",
      "desk": "COUNT(pricing_exception) and COUNT(pricing_exception) / COUNT(*) * 100",
      "portfolio": "COUNT(pricing_exception) and COUNT(pricing_exception) / COUNT(*) * 100",
      "lob": "COUNT(pricing_exception) and COUNT(pricing_exception) / COUNT(*) * 100"
    },
    "source_table": "facility_master",
    "source_field": "pricing_exception_flag"
  },
  {
    "variant_id": "LIMIT_STATUS",
    "variant_name": "Limit Status",
    "parent_metric_id": "LIMIT_STATUS",
    "variant_type": "SOURCED",
    "status": "ACTIVE",
    "formula_display": "Utilization vs limit threshold",
    "rollup_logic": {
      "facility": "Sourced flag (0/1)",
      "counterparty": "Raw flag value",
      "desk": "COUNT(limit_breach) and COUNT(limit_breach) / COUNT(*) * 100",
      "portfolio": "COUNT(limit_breach) and COUNT(limit_breach) / COUNT(*) * 100",
      "lob": "COUNT(limit_breach) and COUNT(limit_breach) / COUNT(*) * 100"
    },
    "source_table": "limit_current_state",
    "source_field": "status_code"
  },
  {
    "variant_id": "EXCEPTION_RATE",
    "variant_name": "Exception Rate",
    "parent_metric_id": "EXCEPTION_RATE",
    "variant_type": "CALCULATED",
    "status": "ACTIVE",
    "formula_display": "Count(Exceptions) / Total Count * 100",
    "rollup_logic": {
      "facility": "Raw sourced or calculated value",
      "counterparty": "SUM(exception_count) / SUM(total_count)",
      "desk": "SUM(exception_count) / SUM(total_count)",
      "portfolio": "SUM(exception_count) / SUM(total_count)",
      "lob": "SUM(exception_count) / SUM(total_count)"
    }
  },
  {
    "variant_id": "FAC_UTIL_STATUS",
    "variant_name": "Facility Utilization Status",
    "parent_metric_id": "FAC_UTIL_STATUS",
    "variant_type": "CALCULATED",
    "status": "ACTIVE",
    "formula_display": "CASE WHEN util < 75% THEN 'Sufficient' WHEN util < 95% THEN 'Approaching' ELSE 'Fully Utilized'",
    "rollup_logic": {
      "facility": "Sourced flag (0/1)",
      "counterparty": "Raw flag value",
      "desk": "COUNT(utilization_category) and COUNT(utilization_category) / COUNT(*) * 100",
      "portfolio": "COUNT(utilization_category) and COUNT(utilization_category) / COUNT(*) * 100",
      "lob": "COUNT(utilization_category) and COUNT(utilization_category) / COUNT(*) * 100"
    }
  },
  {
    "variant_id": "STRESSED_PD",
    "variant_name": "Stressed Probability of Default",
    "parent_metric_id": "STRESSED_PD",
    "variant_type": "CALCULATED",
    "status": "ACTIVE",
    "formula_display": "PD_Baseline * Scenario_Multiplier",
    "rollup_logic": {
      "facility": "Raw sourced value",
      "counterparty": "SUM(stressed_pd * facility_stressed_ead) / SUM(facility_stressed_ead)",
      "desk": "SUM(stressed_pd * cpty_stressed_ead) / SUM(cpty_stressed_ead)",
      "portfolio": "SUM(stressed_pd * desk_stressed_ead) / SUM(desk_stressed_ead)",
      "lob": "SUM(stressed_pd * portfolio_stressed_ead) / SUM(portfolio_stressed_ead)"
    },
    "weighting_basis": "BY_EAD"
  },
  {
    "variant_id": "STRESSED_LGD",
    "variant_name": "Stressed Loss Given Default",
    "parent_metric_id": "STRESSED_LGD",
    "variant_type": "CALCULATED",
    "status": "ACTIVE",
    "formula_display": "LGD_Baseline * Stress_Factor",
    "rollup_logic": {
      "facility": "Raw sourced value",
      "counterparty": "SUM(stressed_lgd * facility_stressed_ead) / SUM(facility_stressed_ead)",
      "desk": "SUM(stressed_lgd * cpty_stressed_ead) / SUM(cpty_stressed_ead)",
      "portfolio": "SUM(stressed_lgd * desk_stressed_ead) / SUM(desk_stressed_ead)",
      "lob": "SUM(stressed_lgd * portfolio_stressed_ead) / SUM(portfolio_stressed_ead)"
    },
    "weighting_basis": "BY_EAD"
  },
  {
    "variant_id": "STRESSED_EL",
    "variant_name": "Stressed Expected Loss",
    "parent_metric_id": "STRESSED_EL",
    "variant_type": "CALCULATED",
    "status": "ACTIVE",
    "formula_display": "Stressed_PD * Stressed_LGD * Stressed_EAD",
    "rollup_logic": {
      "facility": "Raw sourced value",
      "counterparty": "SUM across facilities",
      "desk": "SUM across counterparties",
      "portfolio": "SUM across desks",
      "lob": "SUM across portfolios"
    }
  },
  {
    "variant_id": "STRESSED_EL_RATE",
    "variant_name": "Stressed Expected Loss Rate",
    "parent_metric_id": "STRESSED_EL_RATE",
    "variant_type": "CALCULATED",
    "status": "ACTIVE",
    "formula_display": "Stressed_EL / Stressed_Exposure * 100",
    "rollup_logic": {
      "facility": "Raw sourced or calculated value",
      "counterparty": "SUM(stressed_el) / SUM(stressed_exposure)",
      "desk": "SUM(stressed_el) / SUM(stressed_exposure)",
      "portfolio": "SUM(stressed_el) / SUM(stressed_exposure)",
      "lob": "SUM(stressed_el) / SUM(stressed_exposure)"
    }
  },
  {
    "variant_id": "STRESS_CAP_IMPACT",
    "variant_name": "Stress Capital Impact",
    "parent_metric_id": "STRESS_CAP_IMPACT",
    "variant_type": "CALCULATED",
    "status": "ACTIVE",
    "formula_display": "(Stressed_EL - Baseline_EL) / Capital_Base * 100",
    "rollup_logic": {
      "facility": "Raw sourced or calculated value",
      "counterparty": "SUM(stressed_el - baseline_el) / SUM(capital_base)",
      "desk": "SUM(stressed_el - baseline_el) / SUM(capital_base)",
      "portfolio": "SUM(stressed_el - baseline_el) / SUM(capital_base)",
      "lob": "SUM(stressed_el - baseline_el) / SUM(capital_base)"
    }
  },
  {
    "variant_id": "STRESS_LOSS_DELTA",
    "variant_name": "Stress Loss Delta",
    "parent_metric_id": "STRESS_LOSS_DELTA",
    "variant_type": "CALCULATED",
    "status": "ACTIVE",
    "formula_display": "Stressed_EL - Baseline_EL",
    "rollup_logic": {
      "facility": "Raw sourced value",
      "counterparty": "SUM across facilities",
      "desk": "SUM across counterparties",
      "portfolio": "SUM across desks",
      "lob": "SUM across portfolios"
    }
  },
  {
    "variant_id": "STRESSED_DSCR",
    "variant_name": "Stressed DSCR",
    "parent_metric_id": "STRESSED_DSCR",
    "variant_type": "CALCULATED",
    "status": "ACTIVE",
    "formula_display": "Stressed_Cashflow / Stressed_TDS",
    "rollup_logic": {
      "facility": "Raw sourced value",
      "counterparty": "SUM(stressed_dscr * facility_exposure) / SUM(facility_exposure)",
      "desk": "SUM(stressed_dscr * cpty_exposure) / SUM(cpty_exposure)",
      "portfolio": "SUM(stressed_dscr * desk_exposure) / SUM(desk_exposure)",
      "lob": "SUM(stressed_dscr * portfolio_exposure) / SUM(portfolio_exposure)"
    },
    "weighting_basis": "BY_EAD"
  },
  {
    "variant_id": "STRESSED_LTV",
    "variant_name": "Stressed LTV",
    "parent_metric_id": "STRESSED_LTV",
    "variant_type": "CALCULATED",
    "status": "ACTIVE",
    "formula_display": "Exposure / Stressed_Collateral_Value * 100",
    "rollup_logic": {
      "facility": "Raw sourced value",
      "counterparty": "SUM(stressed_ltv * facility_exposure) / SUM(facility_exposure)",
      "desk": "SUM(stressed_ltv * cpty_exposure) / SUM(cpty_exposure)",
      "portfolio": "SUM(stressed_ltv * desk_exposure) / SUM(desk_exposure)",
      "lob": "SUM(stressed_ltv * portfolio_exposure) / SUM(portfolio_exposure)"
    },
    "weighting_basis": "BY_EAD"
  },
  {
    "variant_id": "PROVISION_RATE",
    "variant_name": "Provision Rate",
    "parent_metric_id": "PROVISION_RATE",
    "variant_type": "CALCULATED",
    "status": "ACTIVE",
    "formula_display": "Provision / Exposure * 100",
    "rollup_logic": {
      "facility": "Raw sourced or calculated value",
      "counterparty": "SUM(provision) / SUM(exposure)",
      "desk": "SUM(provision) / SUM(exposure)",
      "portfolio": "SUM(provision) / SUM(exposure)",
      "lob": "SUM(provision) / SUM(exposure)"
    }
  },
  {
    "variant_id": "PPNR",
    "variant_name": "Pre-Provision Net Revenue",
    "parent_metric_id": "PPNR",
    "variant_type": "CALCULATED",
    "status": "ACTIVE",
    "formula_display": "NII + Non-Interest Income - Non-Interest Expense",
    "rollup_logic": {
      "facility": "Raw sourced value",
      "counterparty": "SUM across facilities",
      "desk": "SUM across counterparties",
      "portfolio": "SUM across desks",
      "lob": "SUM across portfolios"
    }
  },
  {
    "variant_id": "RWA",
    "variant_name": "Risk-Weighted Assets",
    "parent_metric_id": "RWA",
    "variant_type": "CALCULATED",
    "status": "ACTIVE",
    "formula_display": "EAD * Risk_Weight",
    "rollup_logic": {
      "facility": "Raw sourced value",
      "counterparty": "SUM across facilities",
      "desk": "SUM across counterparties",
      "portfolio": "SUM across desks",
      "lob": "SUM across portfolios"
    }
  },
  {
    "variant_id": "RWA_DENSITY",
    "variant_name": "RWA Density",
    "parent_metric_id": "RWA_DENSITY",
    "variant_type": "CALCULATED",
    "status": "ACTIVE",
    "formula_display": "RWA / Exposure * 100",
    "rollup_logic": {
      "facility": "Raw sourced or calculated value",
      "counterparty": "SUM(rwa) / SUM(exposure)",
      "desk": "SUM(rwa) / SUM(exposure)",
      "portfolio": "SUM(rwa) / SUM(exposure)",
      "lob": "SUM(rwa) / SUM(exposure)"
    }
  },
  {
    "variant_id": "CET1_CONSUMPTION",
    "variant_name": "CET1 Capital Consumption",
    "parent_metric_id": "CET1_CONSUMPTION",
    "variant_type": "CALCULATED",
    "status": "ACTIVE",
    "formula_display": "RWA * CET1_Ratio",
    "rollup_logic": {
      "facility": "Raw sourced value",
      "counterparty": "SUM across facilities",
      "desk": "SUM across counterparties",
      "portfolio": "SUM across desks",
      "lob": "SUM across portfolios"
    }
  },
  {
    "variant_id": "LEVERAGE_EXP",
    "variant_name": "Leverage Ratio Exposure",
    "parent_metric_id": "LEVERAGE_EXP",
    "variant_type": "CALCULATED",
    "status": "ACTIVE",
    "formula_display": "On-balance + Off-balance adjustments",
    "rollup_logic": {
      "facility": "Raw sourced value",
      "counterparty": "SUM across facilities",
      "desk": "SUM across counterparties",
      "portfolio": "SUM across desks",
      "lob": "SUM across portfolios"
    }
  },
  {
    "variant_id": "RAROC",
    "variant_name": "Risk-Adjusted Return on Capital",
    "parent_metric_id": "RAROC",
    "variant_type": "CALCULATED",
    "status": "ACTIVE",
    "formula_display": "(Net Income - EL) / Capital Allocated * 100",
    "rollup_logic": {
      "facility": "Raw sourced or calculated value",
      "counterparty": "SUM(net_income - expected_loss) / SUM(capital_allocated)",
      "desk": "SUM(net_income - expected_loss) / SUM(capital_allocated)",
      "portfolio": "SUM(net_income - expected_loss) / SUM(capital_allocated)",
      "lob": "SUM(net_income - expected_loss) / SUM(capital_allocated)"
    }
  },
  {
    "variant_id": "SA_RWA",
    "variant_name": "Standardized Approach RWA",
    "parent_metric_id": "SA_RWA",
    "variant_type": "CALCULATED",
    "status": "ACTIVE",
    "formula_display": "EAD * SA_Risk_Weight",
    "rollup_logic": {
      "facility": "Raw sourced value",
      "counterparty": "SUM across facilities",
      "desk": "SUM across counterparties",
      "portfolio": "SUM across desks",
      "lob": "SUM across portfolios"
    }
  },
  {
    "variant_id": "IRB_RWA",
    "variant_name": "IRB Approach RWA",
    "parent_metric_id": "IRB_RWA",
    "variant_type": "CALCULATED",
    "status": "ACTIVE",
    "formula_display": "EAD * IRB_Risk_Weight(PD,LGD,M)",
    "rollup_logic": {
      "facility": "Raw sourced value",
      "counterparty": "SUM across facilities",
      "desk": "SUM across counterparties",
      "portfolio": "SUM across desks",
      "lob": "SUM across portfolios"
    }
  },
  {
    "variant_id": "FR2590_EXP",
    "variant_name": "FR 2590 Reportable Exposure",
    "parent_metric_id": "FR2590_EXP",
    "variant_type": "CALCULATED",
    "status": "ACTIVE",
    "formula_display": "SUM(exposure) WHERE counterparty meets 2590 threshold",
    "rollup_logic": {
      "facility": "Raw sourced value",
      "counterparty": "SUM across facilities for counterparty",
      "desk": "SUM across counterparties meeting threshold",
      "portfolio": "SUM across desks",
      "lob": "SUM across portfolios"
    }
  },
  {
    "variant_id": "Y14Q_EXP",
    "variant_name": "FR Y-14Q Schedule H.1 Exposure",
    "parent_metric_id": "Y14Q_EXP",
    "variant_type": "HYBRID",
    "status": "ACTIVE",
    "formula_display": "Exposure per Y-14Q field definitions",
    "rollup_logic": {
      "facility": "Raw sourced value",
      "counterparty": "SUM across facilities",
      "desk": "SUM across counterparties",
      "portfolio": "SUM across desks",
      "lob": "SUM across portfolios"
    }
  },
  {
    "variant_id": "Y14M_EXP",
    "variant_name": "FR Y-14M Monthly Exposure",
    "parent_metric_id": "Y14M_EXP",
    "variant_type": "SOURCED",
    "status": "ACTIVE",
    "formula_display": "Monthly exposure snapshot",
    "rollup_logic": {
      "facility": "Raw sourced value",
      "counterparty": "SUM across facilities",
      "desk": "SUM across counterparties",
      "portfolio": "SUM across desks",
      "lob": "SUM across portfolios"
    },
    "source_table": "position_exposure_snapshot",
    "source_field": "gross_exposure_usd"
  }
]