-- ============================================================
-- Metric Library — GSIB seed data
-- Run after 01_DDL.sql. Target: PostgreSQL.
-- ============================================================

TRUNCATE metric_library.metric_variants, metric_library.parent_metrics, metric_library.domains CASCADE;

INSERT INTO metric_library.domains (domain_id, domain_name, domain_description, icon, color, regulatory_relevance, primary_stakeholders)
VALUES ('CQ', 'Credit Quality', 'PD, Rating, DSCR, LTV, Criticized', 'BarChart3', '#1e40af', '["FR Y-14Q","SNC","Interagency CRE"]', '["CRO","Credit Committee"]');

INSERT INTO metric_library.domains (domain_id, domain_name, domain_description, icon, color, regulatory_relevance, primary_stakeholders)
VALUES ('EX', 'Exposure', 'Outstanding, Committed, Utilized, Undrawn, EAD', 'Wallet', '#7c3aed', '["FR Y-14Q","Basel SA"]', '["CRO","Treasury"]');

INSERT INTO metric_library.domains (domain_id, domain_name, domain_description, icon, color, regulatory_relevance, primary_stakeholders)
VALUES ('PR', 'Profitability', 'Revenue, NIM, ROE, ROA, All-In Rate, Spread', 'TrendingUp', '#059669', '["Pillar 3","SEC"]', '["CFO","Desk Heads"]');

INSERT INTO metric_library.domains (domain_id, domain_name, domain_description, icon, color, regulatory_relevance, primary_stakeholders)
VALUES ('LP', 'Loss & Provision', 'EL Rate, EL Dollar, LGD, CECL Allowance', 'AlertTriangle', '#dc2626', '["ASC 326","IFRS 9","FR Y-14Q"]', '["CFO","CRO"]');

INSERT INTO metric_library.domains (domain_id, domain_name, domain_description, icon, color, regulatory_relevance, primary_stakeholders)
VALUES ('CA', 'Capital', 'RWA, Capital Allocated, Leverage Ratio', 'Building2', '#b45309', '["Basel III","FR Y-14Q","CCAR"]', '["CFO","Treasury"]');

INSERT INTO metric_library.domains (domain_id, domain_name, domain_description, icon, color, regulatory_relevance, primary_stakeholders)
VALUES ('PC', 'Pricing', 'Spread, Fee Rate, All-In Rate, Pricing Exceptions', 'Tag', '#0891b2', '["SR 13-3","Pillar 3"]', '["Desk Heads","CRO"]');

INSERT INTO metric_library.domains (domain_id, domain_name, domain_description, icon, color, regulatory_relevance, primary_stakeholders)
VALUES ('PO', 'Portfolio Composition', 'Tenor, Concentration, Collateral, Maturity', 'Target', '#6d28d9', '["FR Y-14Q","Concentration limits"]', '["CRO"]');

INSERT INTO metric_library.domains (domain_id, domain_name, domain_description, icon, color, regulatory_relevance, primary_stakeholders)
VALUES ('EW', 'Early Warning', 'Rating Migration, PD Divergence, Utilization Trend, Amendment Activity', 'Bell', '#e11d48', '["SR 11-7","OCC Handbook"]', '["CRO","Special Assets"]');

INSERT INTO metric_library.parent_metrics (metric_id, metric_name, definition, generic_formula, metric_class, unit_type, direction, risk_appetite_relevant, rollup_philosophy, rollup_description, domain_ids, variant_count, regulatory_references)
VALUES ('PD', 'Probability of Default (PD)', 'The likelihood that a borrower will default on obligations within a specified time horizon. The most fundamental credit risk parameter — feeds EL, capital, pricing, and provisioning.', 'Model Output → Rating → Master Scale → PD', 'SOURCED', 'PERCENTAGE', 'LOWER_BETTER', true, 'Weighted Average by EAD + Distribution by rating grade.', 'PD is an OBLIGOR-level attribute inherited by all facilities. At desk/portfolio/LoB we report EAD-weighted average and rating distribution.', '["CQ","LP"]', 4, '["Basel IRB (BCBS 128)","SR 11-7","FR Y-14Q"]');

INSERT INTO metric_library.parent_metrics (metric_id, metric_name, definition, generic_formula, metric_class, unit_type, direction, risk_appetite_relevant, rollup_philosophy, rollup_description, domain_ids, variant_count, regulatory_references)
VALUES ('DSCR', 'Debt Service Coverage Ratio (DSCR)', 'Measures a borrower''s ability to service debt from operating cash flow. The most fundamental credit quality metric for income-producing lending.', 'Cash Flow / Debt Service', 'CALCULATED', 'RATIO', 'HIGHER_BETTER', true, 'Exposure-Weighted Average + Distribution (% < 1.0x, 1.0–1.2x, 1.2–1.5x, >1.5x).', 'At facility: calculated per facility. At counterparty and above: exposure-weighted average plus distribution buckets for risk appetite.', '["CQ"]', 5, '["Interagency CRE Guidance","FR Y-14Q","SNC","SR 13-3"]');

INSERT INTO metric_library.parent_metrics (metric_id, metric_name, definition, generic_formula, metric_class, unit_type, direction, risk_appetite_relevant, rollup_philosophy, rollup_description, domain_ids, variant_count, regulatory_references)
VALUES ('LTV', 'Loan to Value (LTV)', 'Measures the relationship between the bank''s exposure and the collateral value. The primary collateral coverage metric.', 'Exposure / Collateral Value', 'CALCULATED', 'PERCENTAGE', 'LOWER_BETTER', true, 'Exposure-Weighted Average + Distribution by LTV bucket aligned with supervisory limits.', 'Per facility at facility level; EAD-weighted average and distribution at counterparty, desk, portfolio, LoB.', '["CQ"]', 2, '["Interagency CRE Guidance","FDIC LTV limits","FR Y-14Q"]');

INSERT INTO metric_library.parent_metrics (metric_id, metric_name, definition, generic_formula, metric_class, unit_type, direction, risk_appetite_relevant, rollup_philosophy, rollup_description, domain_ids, variant_count, regulatory_references)
VALUES ('LGD', 'Loss Given Default (LGD)', 'Expected percentage of EAD lost upon default after recovery. Drives EL, RWA, and CECL allowance.', '1 − Recovery Rate', 'SOURCED', 'PERCENTAGE', 'LOWER_BETTER', true, 'EAD-weighted average; recovery model or historical by segment.', 'Obligor/collateral-level attribute; rolled up by EAD weight.', '["CQ","LP"]', 2, '["Basel IRB","SR 11-7","FR Y-14Q"]');

INSERT INTO metric_library.parent_metrics (metric_id, metric_name, definition, generic_formula, metric_class, unit_type, direction, risk_appetite_relevant, rollup_philosophy, rollup_description, domain_ids, variant_count, regulatory_references)
VALUES ('ALL_IN_RATE', 'All-In Rate', 'Total effective interest rate (base + spread + fees) earned on exposure. Core profitability and pricing metric.', 'Σ(Interest + Fees) / Average Exposure', 'CALCULATED', 'PERCENTAGE', 'NEUTRAL', false, 'Exposure-weighted average at all levels.', 'Calculated at facility; exposure-weighted average at counterparty, desk, portfolio, LoB.', '["PR","PC"]', 2, '["Pillar 3","SR 13-3"]');

INSERT INTO metric_library.parent_metrics (metric_id, metric_name, definition, generic_formula, metric_class, unit_type, direction, risk_appetite_relevant, rollup_philosophy, rollup_description, domain_ids, variant_count, regulatory_references)
VALUES ('ROE', 'Return on Equity (ROE)', 'Net income attributable to segment as a percentage of allocated equity. Key performance metric for capital allocation.', 'Net Income / Allocated Equity', 'CALCULATED', 'PERCENTAGE', 'HIGHER_BETTER', false, 'Sum income; equity allocated by methodology; ratio at each level.', 'Income and equity rolled by allocation rules; ratio computed at desk, portfolio, LoB.', '["PR"]', 1, '["Pillar 3","SEC"]');

INSERT INTO metric_library.parent_metrics (metric_id, metric_name, definition, generic_formula, metric_class, unit_type, direction, risk_appetite_relevant, rollup_philosophy, rollup_description, domain_ids, variant_count, regulatory_references)
VALUES ('EXPECTED_LOSS', 'Expected Loss (EL)', 'Probability-weighted credit loss (PD × LGD × EAD). Core risk and provisioning metric.', 'PD × LGD × EAD', 'HYBRID', 'CURRENCY', 'LOWER_BETTER', true, 'Sum at facility/counterparty; sum or model at higher levels.', 'EL dollars sum from facility up; EL rate as EL/EAD at each level.', '["LP","CQ"]', 2, '["Basel IRB","ASC 326","FR Y-14Q"]');

INSERT INTO metric_library.parent_metrics (metric_id, metric_name, definition, generic_formula, metric_class, unit_type, direction, risk_appetite_relevant, rollup_philosophy, rollup_description, domain_ids, variant_count, regulatory_references)
VALUES ('UTILIZATION', 'Utilization Rate', 'Drawn exposure as a percentage of committed exposure. Key early warning and liquidity metric.', 'Drawn / Committed', 'CALCULATED', 'PERCENTAGE', 'NEUTRAL', true, 'Exposure-weighted average or sum(drawn)/sum(committed).', 'Facility-level ratio; at higher levels either WAvg or ratio of sums.', '["EX","EW"]', 2, '["FR Y-14Q","Liquidity monitoring"]');

INSERT INTO metric_library.parent_metrics (metric_id, metric_name, definition, generic_formula, metric_class, unit_type, direction, risk_appetite_relevant, rollup_philosophy, rollup_description, domain_ids, variant_count, regulatory_references)
VALUES ('EAD', 'Exposure at Default (EAD)', 'Expected exposure at time of default. Drives RWA and EL; on- and off-balance-sheet.', 'Drawn + CCF × Undrawn (or model)', 'CALCULATED', 'CURRENCY', 'NEUTRAL', true, 'Sum at all levels.', 'EAD sums from facility to LoB.', '["EX","LP"]', 2, '["Basel IRB","FR Y-14Q"]');

INSERT INTO metric_library.parent_metrics (metric_id, metric_name, definition, generic_formula, metric_class, unit_type, direction, risk_appetite_relevant, rollup_philosophy, rollup_description, domain_ids, variant_count, regulatory_references)
VALUES ('RWA', 'Risk-Weighted Assets (RWA)', 'Exposure weighted by regulatory risk weights. Basis for capital requirements.', 'Σ(EAD × Risk Weight)', 'CALCULATED', 'CURRENCY', 'NEUTRAL', true, 'Sum at all levels.', 'RWA sums from facility to legal entity/LoB.', '["CA"]', 2, '["Basel III","FR Y-14Q","CCAR"]');

INSERT INTO metric_library.parent_metrics (metric_id, metric_name, definition, generic_formula, metric_class, unit_type, direction, risk_appetite_relevant, rollup_philosophy, rollup_description, domain_ids, variant_count, regulatory_references)
VALUES ('CONCENTRATION', 'Concentration', 'Exposure concentration by counterparty, industry, geography, or product. Single-name and sector limits.', 'Exposure / Portfolio or Limit', 'CALCULATED', 'PERCENTAGE', 'LOWER_BETTER', true, 'Distribution and top-N at portfolio/LoB.', 'Concentration ratios and top exposures at desk, portfolio, LoB.', '["PO","CQ"]', 2, '["FR Y-14Q","Large exposure limits"]');

INSERT INTO metric_library.parent_metrics (metric_id, metric_name, definition, generic_formula, metric_class, unit_type, direction, risk_appetite_relevant, rollup_philosophy, rollup_description, domain_ids, variant_count, regulatory_references)
VALUES ('RATING_MIGRATION', 'Rating Migration', 'Movement of obligors across rating grades over time. Early warning and portfolio drift metric.', 'Count or % by from-rating → to-rating', 'CALCULATED', 'COUNT', 'NEUTRAL', true, 'Migration matrix at portfolio/LoB; drill to desk/counterparty.', 'Aggregate migration matrices and deterioration rates.', '["EW","CQ"]', 1, '["SR 11-7","OCC Handbook"]');

INSERT INTO metric_library.metric_variants (variant_id, variant_name, parent_metric_id, variant_type, status, version, effective_date, formula_display, detailed_description, rollup_logic, used_by_dashboards, used_by_reports, regulatory_references, validation_rules, upstream_inputs, downstream_consumers, owner_team, approver, review_cycle, companion_fields, source_system, refresh_frequency)
VALUES ('PD_TTC_INTERNAL', 'TTC PD (Internal Rating)', 'PD', 'SOURCED', 'ACTIVE', 'v2.1', '2025-01-01', 'Scorecard → Rating Grade → Master Scale Lookup → TTC PD', 'Through-the-Cycle PD from internal credit rating system. Long-run average annual default probability.', '{"facility":"Native at facility.","counterparty":"EAD-weighted average.","desk":"EAD-weighted average + distribution.","portfolio":"Same + trend.","lob":"Same + cross-segment."}', '["CRO Dashboard","Risk Appetite","Credit Committee"]', '["FR Y-14Q","Basel RWA","Pricing/RAROC"]', '["Basel IRB (BCBS 128)","SR 11-7","SR 98-18","FR Y-14Q"]', '[{"description":"Range: 0.01% to 100%","severity":"ERROR","rule_type":"RANGE"},{"description":"Basel floor ≥ 0.03% for corporate","severity":"WARNING","rule_type":"RANGE"},{"description":"Staleness: pd_as_of_date within 15 months","severity":"WARNING","rule_type":"STALENESS"}]', '["Internal Rating Scorecard","Master Scale","Credit Officer Override"]', '["EL Rate","RWA","RAROC","WAvg PD (portfolio)"]', 'Credit Risk Analytics', 'Head of Credit Risk', 'ANNUAL', '["pd_rating_grade","pd_model_id","pd_master_scale_version","pd_as_of_date"]', 'Internal Rating Engine → Risk Data Warehouse', 'Annual credit review (12–18 months)');

INSERT INTO metric_library.metric_variants (variant_id, variant_name, parent_metric_id, variant_type, status, version, effective_date, formula_display, detailed_description, rollup_logic, used_by_dashboards, used_by_reports, regulatory_references, validation_rules, upstream_inputs, downstream_consumers, owner_team, approver, review_cycle, companion_fields, source_system, refresh_frequency)
VALUES ('PD_PIT_CECL_1Y', 'PIT PD (CECL 1-Year)', 'PD', 'SOURCED', 'ACTIVE', 'v2.1', '2025-01-01', 'PIT PD = Σ(PD_scenario × Weight) across macro scenarios', 'Point-in-Time 1-year PD reflecting current macroeconomic conditions. Scenario-weighted.', '{"facility":"Native at facility.","counterparty":"EAD-weighted average.","desk":"EAD-weighted average + distribution.","portfolio":"Same + trend.","lob":"Same + cross-segment."}', '["CFO CECL Dashboard","Allowance Committee"]', '["SEC Disclosures","Stage Classification"]', '["ASC 326 (CECL)","FR Y-14Q"]', '[]', '["CECL Macro Model","Scenario Weights"]', '["CECL EL","Stage Classification","Allowance"]', 'Credit Risk Analytics', 'Head of Credit Risk', 'ANNUAL', '["pd_cecl_scenario_weights","pd_pit_by_scenario"]', 'CECL Provisioning Engine', 'Quarterly');

INSERT INTO metric_library.metric_variants (variant_id, variant_name, parent_metric_id, variant_type, status, version, effective_date, formula_display, detailed_description, rollup_logic, used_by_dashboards, used_by_reports, regulatory_references, validation_rules, upstream_inputs, downstream_consumers, owner_team, approver, review_cycle, companion_fields, source_system, refresh_frequency)
VALUES ('PD_REG_FLOORED', 'Regulatory PD (Basel Floored)', 'PD', 'SOURCED', 'ACTIVE', 'v2.1', '2025-01-01', 'Regulatory PD = MAX(Internal TTC PD, 0.03%) × Conservatism Scalar', 'TTC PD with Basel regulatory floors and conservatism adjustments. Drives RWA.', '{"facility":"Native at facility.","counterparty":"EAD-weighted average.","desk":"EAD-weighted average + distribution.","portfolio":"Same + trend.","lob":"Same + cross-segment."}', '["RWA Dashboard","Capital Management"]', '["FR Y-14Q","Pillar 3"]', '["Basel III IRB","B3E Endgame"]', '[{"description":"Regulatory PD ≥ Internal TTC PD","severity":"ERROR"},{"description":"Regulatory PD ≥ 0.03%","severity":"ERROR"}]', '[]', '[]', 'Credit Risk Analytics', 'Head of Credit Risk', 'ANNUAL', '[]', 'Basel Capital Engine', 'Monthly/Quarterly (RWA cycle)');

INSERT INTO metric_library.metric_variants (variant_id, variant_name, parent_metric_id, variant_type, status, version, effective_date, formula_display, detailed_description, rollup_logic, used_by_dashboards, used_by_reports, regulatory_references, validation_rules, upstream_inputs, downstream_consumers, owner_team, approver, review_cycle, companion_fields, source_system, refresh_frequency)
VALUES ('PD_VENDOR_EDF', 'Vendor PD (Moody''s EDF)', 'PD', 'SOURCED', 'ACTIVE', 'v2.1', '2025-01-01', 'EDF = f(Equity Value, Volatility, Liabilities) — Merton model', 'Third-party market-implied PD from Moody''s KMV. Benchmarking and challenger model.', '{"facility":"Native at facility.","counterparty":"EAD-weighted average.","desk":"EAD-weighted average + distribution.","portfolio":"Same + trend.","lob":"Same + cross-segment."}', '["Model Validation","Early Warning"]', '[]', '["SR 11-7 (challenger)","OCC Model Risk"]', '[]', '[]', '[]', 'Credit Risk Analytics', 'Head of Credit Risk', 'ANNUAL', '[]', 'Moody''s CreditEdge Feed', 'Daily');

INSERT INTO metric_library.metric_variants (variant_id, variant_name, parent_metric_id, variant_type, status, version, effective_date, formula_display, detailed_description, rollup_logic, used_by_dashboards, used_by_reports, regulatory_references, validation_rules, upstream_inputs, downstream_consumers, owner_team, approver, review_cycle, companion_fields, source_system, refresh_frequency)
VALUES ('DSCR_CRE_NOI', 'CRE DSCR (NOI-Based)', 'DSCR', 'CALCULATED', 'ACTIVE', 'v2.1', '2025-01-01', 'DSCR = NOI / Annual Debt Service', 'Property-level Net Operating Income divided by annual debt service. For CRE income-producing facilities.', '{"facility":"Native at facility.","counterparty":"EAD-weighted average.","desk":"EAD-weighted average + distribution.","portfolio":"Same + trend.","lob":"Same + cross-segment."}', '["CRE Dashboard","CRO Overview"]', '["FR Y-14Q","SNC Exam"]', '["Interagency CRE Guidance","FR Y-14Q","SNC"]', '[{"description":"Range: -5.0x to 50.0x","severity":"ERROR"},{"description":"DSCR < 1.0x AND non-criticized → investigate","severity":"WARNING"}]', '[{"node_id":"l1-facility-dscr","node_name":"Facility scope","node_type":"FIELD","data_tier":"L1","table":"facility_master","field":"facility_id","description":"Facility and product scope for CRE"},{"node_id":"l2-noi","node_name":"Net Operating Income","node_type":"FIELD","data_tier":"L2","table":"credit_spreading","field":"noi_amount","description":"From spreading / financial statements"},{"node_id":"l2-debt-svc","node_name":"Annual Debt Service","node_type":"FIELD","data_tier":"L2","table":"credit_spreading","field":"debt_service_amt","description":"From servicing / credit agreement"}]', '["WAvg DSCR (portfolio)","Risk Appetite","Criticized Analysis"]', 'Credit Risk Analytics', 'Head of Credit Risk', 'ANNUAL', '["noi_amount","debt_service_amount","financial_stmt_date"]', NULL, NULL);

INSERT INTO metric_library.metric_variants (variant_id, variant_name, parent_metric_id, variant_type, status, version, effective_date, formula_display, detailed_description, rollup_logic, used_by_dashboards, used_by_reports, regulatory_references, validation_rules, upstream_inputs, downstream_consumers, owner_team, approver, review_cycle, companion_fields, source_system, refresh_frequency)
VALUES ('DSCR_CI_EBITDA', 'C&I DSCR (EBITDA)', 'DSCR', 'CALCULATED', 'ACTIVE', 'v2.1', '2025-01-01', 'DSCR = EBITDA / Total Debt Service (all borrower debt)', 'GAAP EBITDA divided by total borrower debt service. For C&I term loans.', '{"facility":"Native at facility.","counterparty":"EAD-weighted average.","desk":"EAD-weighted average + distribution.","portfolio":"Same + trend.","lob":"Same + cross-segment."}', '["C&I Dashboard","CRO Overview"]', '["FR Y-14Q"]', '["OCC Handbook","FR Y-14Q"]', '[]', '["EBITDA (from spreading)","Total Debt Service"]', '["WAvg DSCR","Leverage Analysis"]', 'Credit Risk Analytics', 'Head of Credit Risk', 'ANNUAL', '["ebitda_amount","total_debt_service"]', NULL, NULL);

INSERT INTO metric_library.metric_variants (variant_id, variant_name, parent_metric_id, variant_type, status, version, effective_date, formula_display, detailed_description, rollup_logic, used_by_dashboards, used_by_reports, regulatory_references, validation_rules, upstream_inputs, downstream_consumers, owner_team, approver, review_cycle, companion_fields, source_system, refresh_frequency)
VALUES ('DSCR_CI_ADJEB', 'C&I DSCR (Adjusted EBITDA)', 'DSCR', 'CALCULATED', 'ACTIVE', 'v2.1', '2025-01-01', 'DSCR = Adjusted EBITDA / Total Fixed Charges', 'Adjusted EBITDA with approved add-backs. For leveraged lending.', '{"facility":"Native at facility.","counterparty":"EAD-weighted average.","desk":"EAD-weighted average + distribution.","portfolio":"Same + trend.","lob":"Same + cross-segment."}', '["Leveraged Lending Dashboard"]', '["SR 13-3 Monitoring"]', '["SR 13-3","Interagency Leveraged Lending"]', '[{"description":"Add-back ratio > 30% of GAAP EBITDA → flag","severity":"WARNING"}]', '[]', '[]', 'Credit Risk Analytics', 'Head of Credit Risk', 'ANNUAL', '[]', NULL, NULL);

INSERT INTO metric_library.metric_variants (variant_id, variant_name, parent_metric_id, variant_type, status, version, effective_date, formula_display, detailed_description, rollup_logic, used_by_dashboards, used_by_reports, regulatory_references, validation_rules, upstream_inputs, downstream_consumers, owner_team, approver, review_cycle, companion_fields, source_system, refresh_frequency)
VALUES ('DSCR_COVENANT', 'Covenant DSCR (Per Agreement)', 'DSCR', 'CALCULATED', 'ACTIVE', 'v2.1', '2025-01-01', 'Per credit agreement — facility-specific definitions', 'DSCR as defined in the specific credit agreement. Covenant compliance.', '{"facility":"Native at facility.","counterparty":"EAD-weighted average.","desk":"EAD-weighted average + distribution.","portfolio":"Same + trend.","lob":"Same + cross-segment."}', '["Covenant Compliance","Workout/Special Assets"]', '[]', '["SR 13-3","OCC Handbook (Workouts)"]', '[]', '[]', '[]', 'Credit Risk Analytics', 'Head of Credit Risk', 'ANNUAL', '["covenant_minimum","covenant_headroom","compliance_status"]', NULL, NULL);

INSERT INTO metric_library.metric_variants (variant_id, variant_name, parent_metric_id, variant_type, status, version, effective_date, formula_display, detailed_description, rollup_logic, used_by_dashboards, used_by_reports, regulatory_references, validation_rules, upstream_inputs, downstream_consumers, owner_team, approver, review_cycle, companion_fields, source_system, refresh_frequency)
VALUES ('DSCR_STRESSED', 'Stressed DSCR (Scenario)', 'DSCR', 'CALCULATED', 'ACTIVE', 'v2.1', '2025-01-01', 'Stressed Cash Flow / Stressed Debt Service per macro scenario', 'DSCR projected under CCAR/DFAST stress scenarios.', '{"facility":"Native at facility.","counterparty":"EAD-weighted average.","desk":"EAD-weighted average + distribution.","portfolio":"Same + trend.","lob":"Same + cross-segment."}', '["CCAR Submission","Capital Planning"]', '[]', '["CCAR/DFAST","SR 15-18"]', '[]', '[]', '[]', 'Credit Risk Analytics', 'Head of Credit Risk', 'ANNUAL', '["scenario_id","stress_horizon"]', 'Stress Testing Platform', 'Semi-annual (CCAR)');

INSERT INTO metric_library.metric_variants (variant_id, variant_name, parent_metric_id, variant_type, status, version, effective_date, formula_display, detailed_description, rollup_logic, used_by_dashboards, used_by_reports, regulatory_references, validation_rules, upstream_inputs, downstream_consumers, owner_team, approver, review_cycle, companion_fields, source_system, refresh_frequency)
VALUES ('LTV_CRE_OUT', 'CRE LTV (Outstanding)', 'LTV', 'CALCULATED', 'ACTIVE', 'v2.1', '2025-01-01', 'Outstanding / Appraised Value × 100', 'Current funded balance vs most recent appraisal.', '{"facility":"Native at facility.","counterparty":"EAD-weighted average.","desk":"EAD-weighted average + distribution.","portfolio":"Same + trend.","lob":"Same + cross-segment."}', '["CRE Dashboard"]', '["FR Y-14Q","Regulatory LTV Compliance"]', '["Interagency CRE Guidance","FDIC LTV limits"]', '[{"description":"Range: 0–200%","severity":"ERROR"},{"description":"Appraisal > 24 months → stale","severity":"WARNING"}]', '[{"node_id":"l2-outstanding","node_name":"Outstanding Balance","node_type":"FIELD","data_tier":"L2","table":"position_detail","field":"balance_amount","description":"Current drawn exposure"},{"node_id":"l1-appraisal","node_name":"Appraised Value","node_type":"FIELD","data_tier":"L1","table":"collateral_valuation","field":"appraised_value","description":"Most recent appraisal"}]', '["LGD Estimation","Risk Appetite","Regulatory Compliance"]', 'Credit Risk Analytics', 'Head of Credit Risk', 'ANNUAL', '["appraised_value","appraisal_date","valuation_type"]', NULL, NULL);

INSERT INTO metric_library.metric_variants (variant_id, variant_name, parent_metric_id, variant_type, status, version, effective_date, formula_display, detailed_description, rollup_logic, used_by_dashboards, used_by_reports, regulatory_references, validation_rules, upstream_inputs, downstream_consumers, owner_team, approver, review_cycle, companion_fields, source_system, refresh_frequency)
VALUES ('LTV_CRE_COMMITTED', 'CRE LTV (Committed)', 'LTV', 'CALCULATED', 'ACTIVE', 'v2.1', '2025-01-01', 'Committed / Appraised Value × 100', 'Committed exposure vs collateral value. Used at origination and limit monitoring.', '{"facility":"Native at facility.","counterparty":"EAD-weighted average.","desk":"EAD-weighted average + distribution.","portfolio":"Same + trend.","lob":"Same + cross-segment."}', '["CRE Dashboard","Origination"]', '[]', '["Interagency CRE Guidance"]', '[]', '[]', '[]', 'Credit Risk Analytics', 'Head of Credit Risk', 'ANNUAL', '[]', NULL, NULL);

INSERT INTO metric_library.metric_variants (variant_id, variant_name, parent_metric_id, variant_type, status, version, effective_date, formula_display, detailed_description, rollup_logic, used_by_dashboards, used_by_reports, regulatory_references, validation_rules, upstream_inputs, downstream_consumers, owner_team, approver, review_cycle, companion_fields, source_system, refresh_frequency)
VALUES ('LGD_IRB', 'LGD (IRB Model)', 'LGD', 'SOURCED', 'ACTIVE', 'v2.1', '2025-01-01', 'Collateral model + recovery curve → LGD', 'Internal LGD from IRB models. Facility/collateral-level.', '{"facility":"Native at facility.","counterparty":"EAD-weighted average.","desk":"EAD-weighted average + distribution.","portfolio":"Same + trend.","lob":"Same + cross-segment."}', '["CRO Dashboard","RWA"]', '["FR Y-14Q","Pillar 3"]', '["Basel IRB","SR 11-7"]', '[]', '[]', '[]', 'Credit Risk Analytics', 'Head of Credit Risk', 'ANNUAL', '["lgd_model_id","recovery_rate","collateral_type"]', 'Basel Capital Engine / Risk Data Warehouse', 'Quarterly');

INSERT INTO metric_library.metric_variants (variant_id, variant_name, parent_metric_id, variant_type, status, version, effective_date, formula_display, detailed_description, rollup_logic, used_by_dashboards, used_by_reports, regulatory_references, validation_rules, upstream_inputs, downstream_consumers, owner_team, approver, review_cycle, companion_fields, source_system, refresh_frequency)
VALUES ('LGD_STANDARD', 'LGD (Standardized)', 'LGD', 'SOURCED', 'ACTIVE', 'v2.1', '2025-01-01', 'Supervisory LGD by asset class', 'Regulatory standard LGD for SA book.', '{"facility":"Native at facility.","counterparty":"EAD-weighted average.","desk":"EAD-weighted average + distribution.","portfolio":"Same + trend.","lob":"Same + cross-segment."}', '[]', '[]', '["Basel SA"]', '[]', '[]', '[]', 'Credit Risk Analytics', 'Head of Credit Risk', 'ANNUAL', '[]', 'Regulatory Reporting Engine', 'Monthly');

INSERT INTO metric_library.metric_variants (variant_id, variant_name, parent_metric_id, variant_type, status, version, effective_date, formula_display, detailed_description, rollup_logic, used_by_dashboards, used_by_reports, regulatory_references, validation_rules, upstream_inputs, downstream_consumers, owner_team, approver, review_cycle, companion_fields, source_system, refresh_frequency)
VALUES ('ALL_IN_RATE_WAVG', 'All-In Rate (Exposure-Weighted)', 'ALL_IN_RATE', 'CALCULATED', 'ACTIVE', 'v2.1', '2025-01-01', 'Σ(All-In Rate × EAD) / Σ(EAD)', 'Portfolio exposure-weighted all-in yield.', '{"facility":"Per facility (interest + fees / avg balance).","counterparty":"EAD-weighted average.","desk":"EAD-weighted average.","portfolio":"EAD-weighted average.","lob":"EAD-weighted average."}', '["Pricing Dashboard","NIM Report"]', '["Pillar 3"]', '[]', '[]', '[]', '[]', 'Credit Risk Analytics', 'Head of Credit Risk', 'ANNUAL', '[]', NULL, NULL);

INSERT INTO metric_library.metric_variants (variant_id, variant_name, parent_metric_id, variant_type, status, version, effective_date, formula_display, detailed_description, rollup_logic, used_by_dashboards, used_by_reports, regulatory_references, validation_rules, upstream_inputs, downstream_consumers, owner_team, approver, review_cycle, companion_fields, source_system, refresh_frequency)
VALUES ('ALL_IN_RATE_COMMITTED', 'All-In Rate (Committed-Weighted)', 'ALL_IN_RATE', 'CALCULATED', 'ACTIVE', 'v2.1', '2025-01-01', 'Σ(Rate × Committed) / Σ(Committed)', 'Committed-weighted all-in rate for pipeline and limit view.', '{"facility":"Native at facility.","counterparty":"EAD-weighted average.","desk":"EAD-weighted average + distribution.","portfolio":"Same + trend.","lob":"Same + cross-segment."}', '["Pricing Dashboard"]', '[]', '[]', '[]', '[]', '[]', 'Credit Risk Analytics', 'Head of Credit Risk', 'ANNUAL', '[]', NULL, NULL);

INSERT INTO metric_library.metric_variants (variant_id, variant_name, parent_metric_id, variant_type, status, version, effective_date, formula_display, detailed_description, rollup_logic, used_by_dashboards, used_by_reports, regulatory_references, validation_rules, upstream_inputs, downstream_consumers, owner_team, approver, review_cycle, companion_fields, source_system, refresh_frequency)
VALUES ('ROE_RAROC', 'ROE (RAROC)', 'ROE', 'CALCULATED', 'ACTIVE', 'v2.1', '2025-01-01', 'Net Income / Capital Allocated (RAROC)', 'Return on risk-adjusted capital. Primary performance metric for desks.', '{"facility":"Native at facility.","counterparty":"EAD-weighted average.","desk":"EAD-weighted average + distribution.","portfolio":"Same + trend.","lob":"Same + cross-segment."}', '["Desk P&L","Board Reporting"]', '["Pillar 3"]', '["Pillar 3"]', '[]', '[]', '[]', 'Credit Risk Analytics', 'Head of Credit Risk', 'ANNUAL', '[]', NULL, NULL);

INSERT INTO metric_library.metric_variants (variant_id, variant_name, parent_metric_id, variant_type, status, version, effective_date, formula_display, detailed_description, rollup_logic, used_by_dashboards, used_by_reports, regulatory_references, validation_rules, upstream_inputs, downstream_consumers, owner_team, approver, review_cycle, companion_fields, source_system, refresh_frequency)
VALUES ('EL_ANNUAL', 'Expected Loss (Annual)', 'EXPECTED_LOSS', 'CALCULATED', 'ACTIVE', 'v2.1', '2025-01-01', 'EL = PD × LGD × EAD', 'One-year expected loss from PD, LGD, EAD.', '{"facility":"Native at facility.","counterparty":"EAD-weighted average.","desk":"EAD-weighted average + distribution.","portfolio":"Same + trend.","lob":"Same + cross-segment."}', '["CRO Dashboard","Risk Appetite"]', '["FR Y-14Q"]', '["Basel IRB","FR Y-14Q"]', '[]', '[{"node_id":"l3-pd","node_name":"PD","node_type":"METRIC_VARIANT","data_tier":"L3","description":"Probability of default (TTC or PIT)"},{"node_id":"l3-lgd","node_name":"LGD","node_type":"METRIC_VARIANT","data_tier":"L3","description":"Loss given default"},{"node_id":"l2-ead","node_name":"EAD","node_type":"FIELD","data_tier":"L2","table":"position_detail","field":"ead_amt","description":"Exposure at default (or from EAD metric)"}]', '["CECL Allowance","RAROC","Pricing"]', 'Credit Risk Analytics', 'Head of Credit Risk', 'ANNUAL', '[]', NULL, NULL);

INSERT INTO metric_library.metric_variants (variant_id, variant_name, parent_metric_id, variant_type, status, version, effective_date, formula_display, detailed_description, rollup_logic, used_by_dashboards, used_by_reports, regulatory_references, validation_rules, upstream_inputs, downstream_consumers, owner_team, approver, review_cycle, companion_fields, source_system, refresh_frequency)
VALUES ('EL_CECL_LIFETIME', 'Expected Loss (CECL Lifetime)', 'EXPECTED_LOSS', 'CALCULATED', 'ACTIVE', 'v2.1', '2025-01-01', 'Lifetime EL = Σ(PD_t × LGD × EAD_t)', 'CECL lifetime expected loss. Drives allowance.', '{"facility":"Native at facility.","counterparty":"EAD-weighted average.","desk":"EAD-weighted average + distribution.","portfolio":"Same + trend.","lob":"Same + cross-segment."}', '["CFO CECL Dashboard"]', '[]', '["ASC 326"]', '[]', '["PIT PD term structure","LGD","EAD"]', '["CECL Allowance"]', 'Credit Risk Analytics', 'Head of Credit Risk', 'ANNUAL', '[]', 'CECL Provisioning Engine', 'Quarterly');

INSERT INTO metric_library.metric_variants (variant_id, variant_name, parent_metric_id, variant_type, status, version, effective_date, formula_display, detailed_description, rollup_logic, used_by_dashboards, used_by_reports, regulatory_references, validation_rules, upstream_inputs, downstream_consumers, owner_team, approver, review_cycle, companion_fields, source_system, refresh_frequency)
VALUES ('UTIL_FACILITY', 'Utilization (Facility)', 'UTILIZATION', 'CALCULATED', 'ACTIVE', 'v2.1', '2025-01-01', 'Outstanding / Committed × 100', 'Facility-level utilization. Core early warning metric.', '{"facility":"Native at facility.","counterparty":"EAD-weighted average.","desk":"EAD-weighted average + distribution.","portfolio":"Same + trend.","lob":"Same + cross-segment."}', '["Portfolio Dashboard","Early Warning"]', '["FR Y-14Q"]', '["FR Y-14Q"]', '[]', '[{"node_id":"l2-out-util","node_name":"Outstanding","node_type":"FIELD","data_tier":"L2","table":"position_detail","field":"balance_amount","description":"Current drawn"},{"node_id":"l1-comm-util","node_name":"Committed","node_type":"FIELD","data_tier":"L1","table":"facility_master","field":"committed_amt","description":"Facility commitment"}]', '["Concentration","Liquidity Monitoring"]', 'Credit Risk Analytics', 'Head of Credit Risk', 'ANNUAL', '[]', NULL, NULL);

INSERT INTO metric_library.metric_variants (variant_id, variant_name, parent_metric_id, variant_type, status, version, effective_date, formula_display, detailed_description, rollup_logic, used_by_dashboards, used_by_reports, regulatory_references, validation_rules, upstream_inputs, downstream_consumers, owner_team, approver, review_cycle, companion_fields, source_system, refresh_frequency)
VALUES ('UTIL_COUNTERPARTY', 'Utilization (Counterparty)', 'UTILIZATION', 'CALCULATED', 'ACTIVE', 'v2.1', '2025-01-01', 'Σ(Outstanding) / Σ(Committed) per counterparty', 'Counterparty-level utilization across all facilities.', '{"facility":"Native at facility.","counterparty":"EAD-weighted average.","desk":"EAD-weighted average + distribution.","portfolio":"Same + trend.","lob":"Same + cross-segment."}', '["Counterparty Risk","Early Warning"]', '[]', '[]', '[]', '[]', '[]', 'Credit Risk Analytics', 'Head of Credit Risk', 'ANNUAL', '[]', NULL, NULL);

INSERT INTO metric_library.metric_variants (variant_id, variant_name, parent_metric_id, variant_type, status, version, effective_date, formula_display, detailed_description, rollup_logic, used_by_dashboards, used_by_reports, regulatory_references, validation_rules, upstream_inputs, downstream_consumers, owner_team, approver, review_cycle, companion_fields, source_system, refresh_frequency)
VALUES ('EAD_DRAWN_CCF', 'EAD (Drawn + CCF × Undrawn)', 'EAD', 'CALCULATED', 'ACTIVE', 'v2.1', '2025-01-01', 'EAD = Drawn + CCF × Undrawn', 'Standard regulatory EAD for credit lines.', '{"facility":"Native at facility.","counterparty":"EAD-weighted average.","desk":"EAD-weighted average + distribution.","portfolio":"Same + trend.","lob":"Same + cross-segment."}', '["Exposure Dashboard","RWA"]', '["FR Y-14Q"]', '["Basel IRB"]', '[]', '[{"node_id":"l2-drawn","node_name":"Drawn Amount","node_type":"FIELD","data_tier":"L2","table":"position_detail","field":"drawn_amt","description":"Current funded balance"},{"node_id":"l2-undrawn","node_name":"Undrawn Amount","node_type":"FIELD","data_tier":"L2","table":"position_detail","field":"undrawn_amt","description":"Available to draw"},{"node_id":"l1-ccf","node_name":"Credit Conversion Factor","node_type":"FIELD","data_tier":"L1","table":"facility_master","field":"ccf_pct","description":"Regulatory CCF by product"}]', '["RWA","EL","Concentration"]', 'Credit Risk Analytics', 'Head of Credit Risk', 'ANNUAL', '[]', NULL, NULL);

INSERT INTO metric_library.metric_variants (variant_id, variant_name, parent_metric_id, variant_type, status, version, effective_date, formula_display, detailed_description, rollup_logic, used_by_dashboards, used_by_reports, regulatory_references, validation_rules, upstream_inputs, downstream_consumers, owner_team, approver, review_cycle, companion_fields, source_system, refresh_frequency)
VALUES ('EAD_SA', 'EAD (Standardized)', 'EAD', 'CALCULATED', 'ACTIVE', 'v2.1', '2025-01-01', 'EAD per Basel SA rules', 'Exposure at default for standardized approach.', '{"facility":"Native at facility.","counterparty":"EAD-weighted average.","desk":"EAD-weighted average + distribution.","portfolio":"Same + trend.","lob":"Same + cross-segment."}', '[]', '[]', '["Basel SA"]', '[]', '[]', '[]', 'Credit Risk Analytics', 'Head of Credit Risk', 'ANNUAL', '[]', 'Regulatory Reporting Engine', NULL);

INSERT INTO metric_library.metric_variants (variant_id, variant_name, parent_metric_id, variant_type, status, version, effective_date, formula_display, detailed_description, rollup_logic, used_by_dashboards, used_by_reports, regulatory_references, validation_rules, upstream_inputs, downstream_consumers, owner_team, approver, review_cycle, companion_fields, source_system, refresh_frequency)
VALUES ('RWA_IRB', 'RWA (IRB)', 'RWA', 'CALCULATED', 'ACTIVE', 'v2.1', '2025-01-01', 'RWA = f(EAD, PD, LGD, M)', 'Risk-weighted assets under IRB approach.', '{"facility":"Native at facility.","counterparty":"EAD-weighted average.","desk":"EAD-weighted average + distribution.","portfolio":"Same + trend.","lob":"Same + cross-segment."}', '["Capital Dashboard","RWA Report"]', '["FR Y-14Q","Pillar 3","CCAR"]', '["Basel III IRB","FR Y-14Q"]', '[]', '["EAD","PD","LGD","Maturity"]', '["Capital Ratio","Pillar 3"]', 'Credit Risk Analytics', 'Head of Credit Risk', 'ANNUAL', '[]', NULL, NULL);

INSERT INTO metric_library.metric_variants (variant_id, variant_name, parent_metric_id, variant_type, status, version, effective_date, formula_display, detailed_description, rollup_logic, used_by_dashboards, used_by_reports, regulatory_references, validation_rules, upstream_inputs, downstream_consumers, owner_team, approver, review_cycle, companion_fields, source_system, refresh_frequency)
VALUES ('RWA_SA', 'RWA (Standardized)', 'RWA', 'CALCULATED', 'ACTIVE', 'v2.1', '2025-01-01', 'RWA = EAD × Supervisory Risk Weight', 'Risk-weighted assets under standardized approach.', '{"facility":"Native at facility.","counterparty":"EAD-weighted average.","desk":"EAD-weighted average + distribution.","portfolio":"Same + trend.","lob":"Same + cross-segment."}', '[]', '[]', '["Basel SA"]', '[]', '[]', '[]', 'Credit Risk Analytics', 'Head of Credit Risk', 'ANNUAL', '[]', NULL, NULL);

INSERT INTO metric_library.metric_variants (variant_id, variant_name, parent_metric_id, variant_type, status, version, effective_date, formula_display, detailed_description, rollup_logic, used_by_dashboards, used_by_reports, regulatory_references, validation_rules, upstream_inputs, downstream_consumers, owner_team, approver, review_cycle, companion_fields, source_system, refresh_frequency)
VALUES ('CONC_SINGLE_NAME', 'Single-Name Concentration', 'CONCENTRATION', 'CALCULATED', 'ACTIVE', 'v2.1', '2025-01-01', 'Counterparty EAD / Total Portfolio EAD × 100', 'Largest single-name exposures as % of portfolio.', '{"facility":"Native at facility.","counterparty":"EAD-weighted average.","desk":"EAD-weighted average + distribution.","portfolio":"Same + trend.","lob":"Same + cross-segment."}', '["Concentration Dashboard","CRO"]', '["FR Y-14Q"]', '["Large exposure limits","FR Y-14Q"]', '[{"description":"Flag when > 10% of portfolio","severity":"WARNING"}]', '[]', '[]', 'Credit Risk Analytics', 'Head of Credit Risk', 'ANNUAL', '[]', NULL, NULL);

INSERT INTO metric_library.metric_variants (variant_id, variant_name, parent_metric_id, variant_type, status, version, effective_date, formula_display, detailed_description, rollup_logic, used_by_dashboards, used_by_reports, regulatory_references, validation_rules, upstream_inputs, downstream_consumers, owner_team, approver, review_cycle, companion_fields, source_system, refresh_frequency)
VALUES ('CONC_INDUSTRY', 'Industry Concentration', 'CONCENTRATION', 'CALCULATED', 'ACTIVE', 'v2.1', '2025-01-01', 'Industry EAD / Total EAD × 100', 'Exposure concentration by industry (NAICS/SIC).', '{"facility":"Native at facility.","counterparty":"EAD-weighted average.","desk":"EAD-weighted average + distribution.","portfolio":"Same + trend.","lob":"Same + cross-segment."}', '["Concentration Dashboard"]', '[]', '["FR Y-14Q"]', '[]', '[]', '[]', 'Credit Risk Analytics', 'Head of Credit Risk', 'ANNUAL', '[]', NULL, NULL);

INSERT INTO metric_library.metric_variants (variant_id, variant_name, parent_metric_id, variant_type, status, version, effective_date, formula_display, detailed_description, rollup_logic, used_by_dashboards, used_by_reports, regulatory_references, validation_rules, upstream_inputs, downstream_consumers, owner_team, approver, review_cycle, companion_fields, source_system, refresh_frequency)
VALUES ('RATING_MIG_MATRIX', 'Rating Migration Matrix', 'RATING_MIGRATION', 'CALCULATED', 'ACTIVE', 'v2.1', '2025-01-01', 'Count or % by from-rating → to-rating', 'Migration matrix: counts and rates by rating grade.', '{"facility":"Native at facility.","counterparty":"EAD-weighted average.","desk":"EAD-weighted average + distribution.","portfolio":"Same + trend.","lob":"Same + cross-segment."}', '["Portfolio Quality","Early Warning"]', '[]', '["SR 11-7","OCC Handbook"]', '[]', '["Rating history","Master Scale"]', '["PD calibration","Stress testing"]', 'Credit Risk Analytics', 'Head of Credit Risk', 'ANNUAL', '[]', NULL, NULL);
